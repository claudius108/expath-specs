<?xml version="1.0" encoding="UTF-8"?>
<?oxygen RNGSchema="http://expath.org/ns/xmlspec/xmlspec.rnc" type="compact"?>
<spec xmlns:spec="http://expath.org/ns/xmlspec" role="editors-copy">
    <header>
        <title>PDF Module</title>
        <version>1.0</version>
        <w3c-designation>w3c-designation</w3c-designation>
        <w3c-doctype>EXPath Candidate Module</w3c-doctype>
        <pubdate>
            <day>9</day>
            <month>April</month>
            <year>2013</year>
        </pubdate>
        <publoc>
            <loc href="http://expath.org/spec/pdf/20111108"/>
        </publoc>
        <latestloc>
		<loc href="http://expath.org/spec/pdf"/>
        </latestloc>
        <authlist>
            <author role="editor">
                <name>Claudius Teodorescu</name>
                <affiliation>XML Consultant</affiliation>
            </author>
        </authlist>
	<copyright>
		<p>
			Copyright © 2013 Claudius Teodorescu, published by the
			<loc href="http://w3.org/community/expath/">EXPath Community Group</loc>
			under the
			<loc href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor
				License Agreement (CLA)</loc>
			. A human-readable
			<loc href="http://www.w3.org/community/about/agreements/cla-deed/">summary</loc>
			is
			available.
		</p>
		<p>
			This specification was published by the
			<loc href="http://www.w3.org/community/expath/">EXPath Community Group</loc>
			. It is not a W3C Standard nor is it on the W3C
			Standards Track. Please note that under the
			<loc href="http://www.w3.org/community/about/agreements/cla/">W3C Community Contributor
				License Agreement (CLA)</loc>
			there is a limited opt-out and other conditions apply.
			Learn more about
			<loc href="http://www.w3.org/community/">W3C Community and Business
				Groups</loc>
			.
		</p>
	</copyright>
        <abstract>
            <p>This proposal provides a <phrase id="module-description">module comprising a set of functions for manipulation of PDF documents</phrase>.
            It has been designed to be compatible with XQuery 3.0 and XSLT 3.0, as well as any other standard based on XPath 3.0.</p>
        </abstract>
        <status>
            <p>Must be ignored, but is required by the schema...</p>
        </status>
        <langusage>
            <language>langusage</language>
        </langusage>
        <revisiondesc>
            <p>revisiondesc</p>
        </revisiondesc>
    </header>
    <body>
        <div1>
            <head>Introduction</head>
	    <p>This module allows manipulation of PDF documents.</p>
            <div2>
                <head>Namespace conventions</head>
                <p>The module defined by this document defines functions and elements in the namespace
                  <code id="namespace-uri">http://expath.org/ns/pdf</code>. In this document, the
		  <code>pdf</code> prefix, when used, is bound to this namespace URI.</p>
                <p>Error codes are defined in the namespace <code>http://expath.org/ns/error</code>. In
               this document, <code>err</code> prefix, when used, is bound to this namespace
               URI.</p>
            </div2>
            <div2>
                <head>Error management</head>
                <p>Error conditions are identified by a code (a <code>QName</code>). When such an error
               condition is reached during the execution of the function, a dynamic error is thrown,
               with the corresponding error code (as if the standard XPath function
                  <code>error</code> had been called).</p>
            </div2>
        </div1>
        <div1>
            <head>Creation</head>
		    <p>These functions are for creation of PDF documents.</p>
			<div2>
				<head>The <code>pdf:create()</code> Function</head>
				<p>This function is used for creating a PDF document.</p>
				<eg>
<spec:function>pdf:create</spec:function>($content as <spec:type>xs:anyAtomicType*</spec:type>) as <spec:type>xs:anyAtomicType</spec:type>
				</eg>
			</div2>
			<div2>
				<head>The <code>pdf:create-page()</code> Function</head>
				<p>This function is used for creating a PDF page.</p>
				<eg>
<spec:function>pdf:create-page</spec:function>($content as <spec:type>xs:anyAtomicType?</spec:type>) as <spec:type>xs:anyAtomicType</spec:type>
				</eg>
			</div2>
        </div1>        
        <div1>
            <head>Content</head>
		    <p>These functions are for manipulation of content of the PDF documents.</p>
			<div2>
				<head>The <code>pdf:merge()</code> Function</head>
				<p>This function is used for merging multiple PDF documents or subsets of them (groups of pages).</p>
				<eg>
<spec:function>pdf:merge</spec:function>($document as <spec:type>xs:anyAtomicType</spec:type>,
	$new-resource-metadata as <spec:type>element(pdf:resource-metadata</spec:type>) as <spec:type>xs:anyAtomicType</spec:type>
				</eg>		
			</div2>
			<div2>
				<head>The <code>pdf:split()</code> Function</head>
				<p>This function is used for splitting a PDF document into a number of sections. It outputs a sequence of pages (or documents? - TBD).</p>
				<p>There can be many options for splitting: content splitting, splitting on bookmarks, extract until text.</p>
				<eg>
<spec:function>pdf:split</spec:function>($document as <spec:type>xs:base64Binary</spec:type>,
	$options as <spec:type>element(pdf:options)</spec:type>) as <spec:type>xs:base64Binary+</spec:type>
				</eg>
				<ulist>
					<item>
						<p><code>$document</code> is the PDF document to be splitted.</p>
					</item>
					<item>
						<p><code>$options</code> are the options for the current operation.</p>
					</item>
				</ulist>
				<div3>
					<head>The <code>pdf:options</code> element</head>
					<eg>
	&lt;pdf:options&gt;
		(pdf:split-delimiter,
		pdf:output-filename?)
	&lt;/pdf:options&gt;
					</eg>			
					<ulist>
						<item>
							<p>the <code>pdf:split-delimiter</code> child element
							specifies the delimiter used for splitting the input PDF
							document.</p>
						</item>					
						<item>
							<p>the <code>pdf:output-filename</code> child element is the name of the outputted PDF file.</p>
						</item>
					</ulist>
				</div3>	
			</div2>
			<div2>
				<head>The <code>pdf:extract-pages()</code> Function</head>
				<p>This function is used for extracting pages from a PDF document. It has a parameter for setting the deletion of the respective pages after extraction.
				It returns the extracted pages.</p>
			</div2>
			<div2>
				<head>The <code>pdf:insert-pages()</code> Function</head>
				<p>This function is used for inserting pages into a PDF document.</p>
			</div2>
			<div2>
				<head>The <code>pdf:delete-pages()</code> Function</head>
				<p>This function is used for deleting pages from a PDF document.</p>
			</div2>
			<div2>
				<head>The <code>pdf:rotate-pages()</code> Function</head>
				<p>This function is used for rotating pages of a PDF document.</p>
			</div2>
			<div2>
				<head>The <code>pdf:revert-pages()</code> Function</head>
				<p>This function is used for reverting pages of a PDF document.</p>
			</div2>	
        </div1>
        <div1>
            <head>Links and bookmarks</head>
		    <p>These functions are for manipulation of links and bookmarks of a PDF document.</p>
			<div2>
				<head>The <code>pdf:create-bookmark()</code> Function</head>
				<p>This function is used to create bookmarks in a PDF document.</p>
			</div2>	
			<div2>
				<head>The <code>pdf:edit-bookmark()</code> Function</head>
				<p>This function is used to edit bookmarks of a PDF document.</p>
			</div2>
			<div2>
				<head>The <code>pdf:delete-bookmark()</code> Function</head>
				<p>This function is used to delete bookmarks from a PDF document.</p>
			</div2>
			<div2>
				<head>The <code>pdf:import-bookmarks()</code> Function</head>
				<p>This function is used to import bookmarks to a PDF document.</p>
			</div2>
			<div2>
				<head>The <code>pdf:export-bookmarks()</code> Function</head>
				<p>This function is used to export bookmarks from a PDF document.</p>
			</div2>
			<div2>
				<head>The <code>pdf:create-link()</code> Function</head>
				<p>This function is used to create links in a PDF document.</p>
			</div2>	
			<div2>
				<head>The <code>pdf:edit-link()</code> Function</head>
				<p>This function is used to edit links of a PDF document.</p>
			</div2>
			<div2>
				<head>The <code>pdf:delete-link()</code> Function</head>
				<p>This function is used to delete links from a PDF document.</p>
			</div2>
			<div2>
				<head>The <code>pdf:import-links()</code> Function</head>
				<p>This function is used to import links to a PDF document.</p>
			</div2>
			<div2>
				<head>The <code>pdf:export-links()</code> Function</head>
				<p>This function is used to export links from a PDF document.</p>
			</div2>
        </div1>        
        <div1>
            <head>Form controls</head>
		    <p>These functions are designated for gathering information about and interacting with form controls of a PDF document.</p>
			<div2>
				<head>The <code>pdf:get-text-fields()</code> Function</head>
				<p>Get all the text fields from a sequence of PDF contents. Returns a sequence of maps containing information about the text fields for each
				content inputted.</p>
				<p>The map containing informations about the text fields consists of pairs of fully qualified name and value for each text field.</p>
				<eg>
<spec:function>pdf:get-text-fields</spec:function>($content as <spec:type>xs:anyAtomicType*</spec:type>) as <spec:type>map*</spec:type>
				</eg>
				<ulist>
					<item>
						<p><code>$content</code> is the PDF content where to get the text fields from.</p>
					</item>
				</ulist>
			</div2>
			<div2>
				<head>The <code>pdf:set-text-fields()</code> Function</head>
				<p>Set the text fields of a sequence of PDF contents. Returns the updated sequence of PDF contents.</p>
				<eg>
<spec:function>pdf:set-text-fields</spec:function>($content as <spec:type>xs:anyAtomicType*</spec:type>, $text-fields as <spec:type>map*</spec:type>) as <spec:type>xs:anyAtomicType*</spec:type>
				</eg>
				<ulist>
					<item>
						<p><code>$content</code> is the PDF content where to set the text fields to.</p>
					</item>
					<item>
						<p><code>$text-fields</code> are the information sets about the text fields. A map contains informations
						about the text fields consists of pairs of fully qualified name and value for each text field to be set.</p>
					</item>					
				</ulist>
			</div2>			
        </div1>
        <div1>
            <head>Stamping, commenting, annotating, and marking</head>
		    <p>These functions are associating various objects with a PDF document.</p>
			<div2>
				<head>The <code>pdf:stamp()</code> Function</head>
				<p>This function is used for applying a stamp to a PDF document.</p>
			</div2>
        </div1>
        <div1>
            <head>Content rasterization</head>
		    <p>These functions are for rendering the PDF documents.</p>
			<div2>
				<head>The <code>pdf:to-image()</code> Function</head>
				<p>This function is used for converting a PDF document to images.</p>
			</div2>
        </div1>
        <div1>
            <head>Validation</head>
		    <p>These functions are designated for validating a PDF document.</p>
			<div2>
				<head>The <code>pdf:validate()</code> Function</head>
				<p>This function is used for validating a PDF document.</p>
			</div2>
			<div2>
				<head>The <code>pdf:validate-links()</code> Function</head>
				<p>This function is used for validating the links contained by a PDF document.</p>
			</div2>
			<div2>
				<head>The <code>pdf:validate-bookmarks()</code> Function</head>
				<p>This function is used for validating the bookmarks contained by a PDF document.</p>
			</div2>
        </div1>
        <div1>
            <head>Optimization</head>
		    <p>These functions are designated for optimizing a PDF document.</p>
			<div2>
				<head>The <code>pdf:optimize()()</code> Function</head>
				<p>This function is used for optimizing a PDF document, by reducing the file size without affecting quality.</p>
			</div2>
			<div2>
				<head>The <code>pdf:linearize()</code> Function</head>
				<p>This function is used for linearizing a PDF document, for fast delivery over a network. The first page is already visible, while the rest is downloaded in
				background</p>
			</div2>
			<div2>
				<head>The <code>pdf:compress()</code> Function</head>
				<p>This function is used for compressing a PDF document.</p>
			</div2>	
			<div2>
				<head>The <code>pdf:uncompress()</code> Function</head>
				<p>This function is used for uncompressing a PDF document.</p>
			</div2>
        </div1>        
        <div1>
            <head>Security</head>
		    <p>These functions are for protection of the PDF documents.</p>
			<div2>
				<head>The <code>pdf:encrypt()</code> Function</head>
				<p>This function is used for encrypting a PDF document by using a digital certificate.</p>
			</div2>
			<div2>
				<head>The <code>pdf:decrypt()</code> Function</head>
				<p>This function is used for decrypting a PDF document.</p>
			</div2>
			<div2>
				<head>The <code>pdf:add-signature()</code> Function</head>
				<p>This function is used for adding an electronic signature to a PDF document.</p>
			</div2>
			<div2>
				<head>The <code>pdf:remove-signature()</code> Function</head>
				<p>This function is used for removing an electronic signature from a PDF document.</p>
			</div2>
        </div1>
        <div1>
            <head>Repairing</head>
		    <p>These functions are for repairing and recovering of PDF documents.</p>
			<div2>
				<head>The <code>pdf:repair()</code> Function</head>
				<p>This function is used for repairing a PDF document.</p>
			</div2>
        </div1>        
        <div1>
            <head>Scenarios of usage</head>
		    <p>Some scenarios of usage of the functions comprised by this module.</p>
			<div2>
				<head>Insert a (blank) page every nth page</head>
				<p></p>
				<eg>pdf:insert-pages(pdf:create-page(), $pattern)</eg>				
			</div2>
			<div2>
				<head>Delete broken links</head>
				<p></p>
				<eg>
for $broken-link in pdf:validate-links($pdf-document)
return if () then () else ()
				</eg>
			</div2>
			<div2>
				<head>Audit Bookmarks and Links</head>
				<p>One can validate bookmarks and links, and export those found broken. They can be included in report and/or fixed and imported to document.</p>
				<eg>
				</eg>
			</div2>
			<div2>
				<head>Validate PDF document</head>
				<p>One can validate a PDf document using certain validation criteria, as such: dimensions of all/certain pages should be A4 (297 mm * 210 mm),
				there should be no content within a certain rectangular area of a page (left margin where the print shop inserts a bar code, for instance),
				number of pages should be less than N, PDF version used.</p>
				<eg>
				</eg>
			</div2>
        </div1>
    </body>
    <back>
        <div1>
            <head>References</head>
            <blist>
	            <bibl id="xpath-30" key="XPath 3.0">
	               <loc href="http://w3.org/TR/xpath-30/">XML Path Language (XPath) 3.0</loc>.
	               Jonathan Robie, Don Chamberlin, Michael Dyck, John Snelson, editors. W3C Working Draft, 13 December 2011.</bibl>
	            <bibl id="xslt-30" key="XSLT 3.0">                        
	               <loc href="http://w3.org/TR/xslt-30/">XSL Transformations (XSLT) Version 3.0</loc>.
	               Michael Kay, editor. W3C Working Draft, 10 July 2012.</bibl>         
	            <bibl id="xquery-30" key="XQuery 3.0">                        
	               <loc href="http://w3.org/TR/xquery-30/">XQuery 3.0: An XML Query Language</loc>.
	               Jonathan Robie, Don Chamberlin, Michael Dyck, John Snelson, editors. W3C Working Draft, 13 December 2011.</bibl>
            <bibl id="xpath-functions-30" key="XPath and XQuery Functions and Operators 3.0">
               <loc href="http://w3.org/TR/xpath-functions-30/">XPath and XQuery Functions and Operators 3.0</loc>.
               Michael Kay, editor. W3C Working Draft, 13 December 2011.</bibl>                                
            <bibl id="xpath-datamodel-30" key="XQuery and XPath Data Model 3.0">
               <loc href="http://w3.org/TR/xpath-datamodel-30/">XQuery and XPath Data Model 3.0</loc>.
               Norman Walsh, Anders Berglund, John Snelson, editors. W3C Working Draft, 13 December 2011.</bibl>               
            <bibl id="xfa-3.3" key="XFA Specification 3.3">
               <loc href="https://partners.adobe.com/public/developer/en/xml/xfa_spec_3_3.pdf">XML Forms Architecture (XFA) Specification, version 3.3</loc>.
               Adobe Systems Incorporated, 09 January 2012.</bibl>               
            <bibl id="xfdf-3.0" key="XFDF Specification 3.0">
               <loc href="https://partners.adobe.com/public/developer/en/xml/XFDF_Spec_3.0.pdf">XML Forms Data Format Specification, version 3.0</loc>.
               Adobe Systems Incorporated, August 2009.</bibl>
            <bibl id="pdf-reference-1.7" key="PDF Reference 1.7">
               <loc href="http://adobe.com/content/dam/Adobe/en/devnet/acrobat/pdfs/pdf_reference_1-7.pdf">Adobe® Portable Document Format, version 1.7</loc>.
               Adobe Systems Incorporated, November 2006.</bibl>             
            </blist>
        </div1>
        <div1>
            <head>Summary of Error Conditions</head>
            <blist>
		    <bibl id="errPDF001" key="err:PDF001">err:PDF001: The transformation formula is not supported.</bibl>
		    <bibl id="errPDF002" key="err:PDF002">err:PDF002: The remote resource does not exist.</bibl>
		    <bibl id="errPDF003" key="err:PDF003">err:PDF003: The user has no rights to access the remote resource.</bibl>
		    <bibl id="errPDF004" key="err:PDF004">err:PDF004: The syntax of the transformation formula is wrong.</bibl>
            </blist>
        </div1>
    </back>
</spec>