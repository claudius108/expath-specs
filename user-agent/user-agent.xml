<?xml version="1.0" encoding="UTF-8"?>

<?oxygen RNGSchema="http://expath.org/ns/xmlspec/xmlspec.rnc" type="compact"?>

<spec xmlns:spec="http://expath.org/ns/xmlspec" role="editors-copy">
   <header>
      <title>User Agent Module</title>
      <version>1.0</version>
      <w3c-designation>w3c-designation</w3c-designation>
      <w3c-doctype>EXPath Candidate Module</w3c-doctype>
      <pubdate>
         <day>12</day>
         <month>February</month>
         <year>2012</year>
      </pubdate>
      <latestloc>
         <loc href="http://expath.org/spec/location"/>
      </latestloc>
      <authlist>
         <author role="editor">
            <name id="cteodorescu">Claudius Teodorescu</name>
            <affiliation>XML Consultant</affiliation>
         </author>
      </authlist>
	<copyright>
		<p>
			Copyright Â© 2013 Claudius Teodorescu, published by the
			<loc href="http://w3.org/community/expath/">EXPath Community Group</loc>
			under the
			<loc href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor
				License Agreement (CLA)</loc>
			. A human-readable
			<loc href="http://www.w3.org/community/about/agreements/cla-deed/">summary</loc>
			is
			available.
		</p>
		<p>
			This specification was published by the
			<loc href="http://www.w3.org/community/expath/">EXPath Community Group</loc>
			. It is not a W3C Standard nor is it on the W3C
			Standards Track. Please note that under the
			<loc href="http://www.w3.org/community/about/agreements/cla/">W3C Community Contributor
				License Agreement (CLA)</loc>
			there is a limited opt-out and other conditions apply.
			Learn more about
			<loc href="http://www.w3.org/community/">W3C Community and Business
				Groups</loc>
			.
		</p>
	</copyright>
      <abstract>
         <p>This proposal defines a <phrase id="module-description">module comprising a set of functions for actions within an user agent</phrase>.
         It has been designed to be compatible with XQuery 3.0 and XSLT 3.0, as well as any other standard based on XPath 3.0.</p>
      </abstract>
      <status>
         <p>Must be ignored, but is required by the schema...</p>
      </status>
      <langusage>
         <language>langusage</language>
      </langusage>
      <revisiondesc>
         <p>revisiondesc</p>
      </revisiondesc>
   </header>
   <body>
      <div1>
         <head>Introduction</head>
         <p>This proposal defines a <phrase>module for providing functions dealing with actions within
         an user agent</phrase>. It has been designed to be compatible with XQuery 3.0 and XSLT 3.0, as well as any other standard
         based on XPath 3.0.</p>
         <div2>
            <head>Namespace conventions</head>
            <p>The module defined by this document defines functions and elements in the namespace
                  <code id="module-namespace">http://expath.org/ns/user-agent</code>. In this document, the
                  <code id="module-prefix">ua</code> prefix, when used, is bound to this namespace URI.</p>
            <p>Error codes are defined in the namespace <code>http://expath.org/ns/error</code>. In
               this document, the <code>err</code> prefix, when used, is bound to this namespace
               URI.</p>
         </div2>
         <div2>
            <head>Error management</head>
            <p>Error conditions are identified by a code (a <code>QName</code>). When such an error
               condition is reached during the execution of the function, a dynamic error is thrown,
               with the corresponding error code (as if the standard XPath function
                  <code>error</code> had been called).</p>
         </div2>
      </div1>
       <div1>
         <head>External variables</head>
         <p>These variables are available to the XQuery scripts associated with a document.</p>
         <div2>
            <head>The <code>ua:document</code> variable</head>
            <p>This variable is bound to the document itself.</p>
         </div2>        
      </div1>
      <div1>
         <head>Events</head>
         <p>These functions deal with DOM events.</p>
         <div2>
            <head>The <code>ua:create-event()</code> function</head>
            <p>This function creates a custom event.</p>
            <eg>
<spec:function>ua:create-event</spec:function>($event-name as <spec:type>xs:QName</spec:type>) as <spec:type>empty()</spec:type>
</eg>
            <ulist>
               <item>
                  <p><code>$event-name</code> is the name of the custom event.</p>
               </item>
            </ulist>            
         </div2>
         <div2>
            <head>The <code>ua:add-event-listener()</code> function</head>
            <p>This function adds a listener to an event.</p>
            <eg>
<spec:function>ua:add-event-listener</spec:function>($event-target as <spec:type>xs:string</spec:type>, $event-type as <spec:type>xs:string</spec:type>,
	$listener as <spec:type>item()</spec:type>) as <spec:type>empty()</spec:type>
</eg>
            <ulist>
               <item>
                  <p><code>$event-target</code> is the name of the custom event.</p>
               </item>
               <item>
                  <p><code>$event-type</code> is the name of the custom event.</p>
               </item>
               <item>
                  <p><code>$listener</code> is the name of the custom event.</p>
               </item>
            </ulist>            
         </div2>
      </div1>      
      <div1>
         <head>Actions</head>
         <p>These functions define actions to be executed by direct invoking or when a certain event occurs.</p>
         <div2>
            <head>The <code>ua:action()</code> function</head>
            <p>This function defines an action to be invoked when a DOM event occurs.</p>
            <eg>
<spec:function>ua:action</spec:function>($id as <spec:type>xs:ID</spec:type>,
	$parameters as <spec:type>map(xs:string, xs:string)</spec:type>,
	$code-block as <spec:type>item()*</spec:type>) as <spec:type>empty()</spec:type>
</eg>
            <eg>
<spec:function>ua:action</spec:function>($id as <spec:type>xs:ID</spec:type>,
	$event-name as <spec:type>xs:QName</spec:type>,
	$parameters as <spec:type>map(xs:string, xs:string</spec:type>,
	$code-block as <spec:type>item()*</spec:type>) as <spec:type>empty()</spec:type>
</eg>
            <ulist>
               <item>
                  <p><code>$id</code> is the action's identificator. If the identificator is not unique within the script, this is an error <bibref ref="errUA01"/>.</p>
               </item>
               <item>
                  <p><code>$event-name</code> represents the name of the event that triggers the execution of the action.
                   If the event does not exist, this is an error <bibref ref="errUA02"/>.</p>
               </item>                
               <item>
                  <p><code>$parameters</code> represents the parameters passed for the execution of the action.</p>
               </item>   
               <item>
                  <p><code>$code-block</code> represents the code to be executed.</p>
               </item>
            </ulist>            
         </div2>
      </div1>
      <div1>
         <head>Mutation observers</head>
         <p>These functions deal with Mutation observers, as they are defined in <bibref ref="dom-4"/>.</p>
         <div2>
            <head>The <code>ua:observer()</code> function</head>
            <p>This function creates a mutations observer. It has two signatures, one taking as second parameter a list of action handlers separated by spaces,
            and the other one considering as second parameter a function item.</p>
            <eg>
<spec:function>ua:observer</spec:function>($id as <spec:type>xs:ID</spec:type>, $action-handlers as <spec:type>xs:IDREFS</spec:type>) as <spec:type>empty()</spec:type>
</eg>
            <eg>
<spec:function>ua:observer</spec:function>($id as <spec:type>xs:ID</spec:type>, $action as <spec:type>function(*)</spec:type>) as <spec:type>empty()</spec:type>
</eg>
            <ulist>
               <item>
                  <p><code>$id</code> is the observer's identificator. If the identificator is not unique within the script, this is an error <bibref ref="errUA01"/>.</p>
               </item>            
               <item>
                  <p><code>$action-handlers</code> is the list of action handlers separated by spaces, to be executed. If the action handler are not unique within the script,
                  this is an error <bibref ref="errUA01"/>.</p>
               </item>
               <item>
                  <p><code>$action</code> is the function item to be executed.</p>
               </item>
            </ulist>            
         </div2>
         <div2>
            <head>The <code>ua:connect-observer()</code> function</head>
            <p>This function connects an observer to a node, in order to observe the node mutations.</p>
            <eg>
<spec:function>ua:connect-observer</spec:function>($observer-handler as <spec:type>xs:IDREF</spec:type>, $node-selector as <spec:type>xs:string</spec:type>,
	$options as <spec:type>map(xs:string, xs:string)</spec:type>) as <spec:type>empty()</spec:type>
</eg>
            <ulist>
               <item>
                  <p><code>$observer-handler</code> is the observer's handler. If the identificator does not exist, this is an error <bibref ref="errUA03"/>.</p>
               </item>            
               <item>
                  <p><code>$node-selector</code> is the selector used to select the node to be observed. The selector can be an XPath or a CSS selector. If the
                  selector selects multiple nodes, only the first one in document order will be observed. If the selector selects no nodes, this is an error <bibref ref="errUA04"/>.</p>
                  <note>Details for differenciating between an XPath or CSS selector are to be given.</note>
               </item>
               <item>
                  <p><code>$options</code> are the options describing the properties and values for observing the selected node. See <bibref ref="dom-4"/> for more
                  details.</p>
               </item>
            </ulist>            
         </div2>
         <div2>
            <head>The <code>ua:disconnect-observer()</code> function</head>
            <p>This function disconnects an observer from a node. The observer will stop observing the node until it will be connected again to the node.</p>
            <eg>
<spec:function>ua:disconnect-observer</spec:function>($observer-handler as <spec:type>xs:IDREF</spec:type>) as <spec:type>empty()</spec:type>
</eg>
            <ulist>
               <item>
                  <p><code>$observer-handler</code> is the observer's handler. If the identificator does not exist, this is an error <bibref ref="errUA03"/>.</p>
               </item>
            </ulist>            
         </div2>         
         
         
      </div1>
<!--       <div1> -->
<!--          <head>Bindings</head> -->
<!--          <p>These functions deal with DOM events.</p> -->
<!--          <div2> -->
<!--             <head>The <code>ua:action()</code> function</head> -->
<!--             <p>This function returns the country code composed of 2 digits, according to ISO 3166-1 Alpha-2.</p> -->
<!--             <eg> -->
<!-- <spec:function>ua:action</spec:function>($ip-address as <spec:type>xs:string</spec:type>) as <spec:type>xs:string</spec:type> -->
<!-- </eg> -->
<!--             <ulist> -->
<!--                <item> -->
<!--                   <p><code>$ip-address</code> is the user agent's IP address. If the IP address is not valid, this is an error <bibref ref="errUA01"/>.</p> -->
<!--                </item> -->
<!--             </ulist>             -->
<!--          </div2> -->
<!--       </div1>       -->      
   </body>
   <back>
      <div1>
         <head>References</head>
         <blist>
	            <bibl id="xpath-30" key="XPath 3.0">
	               <loc href="http://w3.org/TR/xpath-30/">XML Path Language (XPath) 3.0</loc>.
	               Jonathan Robie, Don Chamberlin, Michael Dyck, John Snelson, editors. W3C Working Draft, 13 December 2011.</bibl>
	            <bibl id="xslt-30" key="XSLT 3.0">                        
	               <loc href="http://w3.org/TR/xslt-30/">XSL Transformations (XSLT) Version 3.0</loc>.
	               Michael Kay, editor. W3C Working Draft, 10 July 2012.</bibl>         
	            <bibl id="xquery-30" key="XQuery 3.0">                        
	               <loc href="http://w3.org/TR/xquery-30/">XQuery 3.0: An XML Query Language</loc>.
	               Jonathan Robie, Don Chamberlin, Michael Dyck, John Snelson, editors. W3C Working Draft, 13 December 2011.</bibl>
	            <bibl id="xpath-functions-30" key="XPath and XQuery Functions and Operators 3.0">
	               <loc href="http://w3.org/TR/xpath-functions-30/">XPath and XQuery Functions and Operators 3.0</loc>.
	               Michael Kay, editor. W3C Working Draft, 13 December 2011.</bibl>
	            <bibl id="xpath-datamodel-30" key="XQuery and XPath Data Model 3.0">
	               <loc href="http://w3.org/TR/xpath-datamodel-30/">XQuery and XPath Data Model 3.0</loc>.
               	   Norman Walsh, Anders Berglund, John Snelson, editors. W3C Working Draft, 13 December 2011.</bibl>
	            <bibl id="dom-4" key="W3C DOM4">
	               <loc href="http://w3.org/TR/dom/">W3C DOM4</loc>.
               	   Anne van Kesteren, Aryeh Gregor, Ms2ger, Alex Russell, Robin Berjon, editors. W3C Last Call Working Draft, 04 February 2014.</bibl>               	                   
         </blist>
      </div1>
      <div1>
         <head>Summary of Error Conditions</head>
         <blist id="summary-of-error-conditions">
         	<bibl id="errUA01" key="err:UA01">The identificator $id is not unique.</bibl>
         	<bibl id="errUA02" key="err:UA02">The event $event-name does not exist.</bibl>
         	<bibl id="errUA03" key="err:UA03">The identificator $id does not exist.</bibl>
         	<bibl id="errUA04" key="err:UA04">No node was selected.</bibl>         	
         </blist>
      </div1>
   </back>
</spec>
