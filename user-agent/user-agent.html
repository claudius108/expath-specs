<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
      <title>User Agent Module 1.0</title>
      <link rel="stylesheet" type="text/css" href="http://www.w3.org/StyleSheets/TR/base.css" /><style type="text/css">
code           { font-family: monospace; }

div.constraint,
div.issue,
div.note,
div.notice     { margin-left: 2em; }

ol.enumar      { list-style-type: decimal; }
ol.enumla      { list-style-type: lower-alpha; }
ol.enumlr      { list-style-type: lower-roman; }
ol.enumua      { list-style-type: upper-alpha; }
ol.enumur      { list-style-type: upper-roman; }


div.exampleInner pre { margin-left: 1em;
                       margin-top: 0em; margin-bottom: 0em}
div.exampleOuter {border: 4px double gray;
                  margin: 0em; padding: 0em}
div.exampleInner { background-color: #d5dee3;
                   border-top-width: 4px;
                   border-top-style: double;
                   border-top-color: #d3d3d3;
                   border-bottom-width: 4px;
                   border-bottom-style: double;
                   border-bottom-color: #d3d3d3;
                   padding: 4px; margin: 0em }
div.exampleWrapper { margin: 4px }
div.exampleHeader { font-weight: bold;
                    margin: 4px}

      code.function { font-weight: bold; }
      code.type { font-style: italic; }
      /* h1, h2, h3 { color: #84001C; background: white } */
      /* a, :link, :visited, a:active { color: #84005C; background: white } */
      body {
        background-image: url(http://expath.org/images/logo-candidate.png);
      }
   </style></head>
   <body>
      <p><a href="http://expath.org/"><img src="http://expath.org/images/expath-icon.png" alt="EXPath" height="32" width="32" /></a></p>
      <div class="head">
         
         <h1><a name="title" id="title"></a>User Agent Module 1.0
         </h1>
         
         <h2><a name="w3c-doctype" id="w3c-doctype"></a>EXPath Candidate Module 12 February 2012
         </h2>
         <dl>
            <dt>Latest version:</dt>
            <dd>
               <a href="http://expath.org/spec/location">http://expath.org/spec/location</a>
               
            </dd>
            <dt>Editor:</dt>
            <dd>Claudius Teodorescu, XML Consultant</dd>
         </dl>
         <p class="copyright">
            			Copyright Â© 2013 Claudius Teodorescu, published by the
            			<a href="http://w3.org/community/expath/">EXPath Community Group</a>
            			under the
            			<a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor
               				License Agreement (CLA)</a>
            			. A human-readable
            			<a href="http://www.w3.org/community/about/agreements/cla-deed/">summary</a>
            			is
            			available.
            		
         </p>
         <p class="copyright">
            			This specification was published by the
            			<a href="http://www.w3.org/community/expath/">EXPath Community Group</a>
            			. It is not a W3C Standard nor is it on the W3C
            			Standards Track. Please note that under the
            			<a href="http://www.w3.org/community/about/agreements/cla/">W3C Community Contributor
               				License Agreement (CLA)</a>
            			there is a limited opt-out and other conditions apply.
            			Learn more about
            			<a href="http://www.w3.org/community/">W3C Community and Business
               				Groups</a>
            			.
            		
         </p>
      </div>
      <hr />
      <div>
         
         <h2><a name="abstract" id="abstract"></a>Abstract
         </h2>
         <p>This proposal defines a <span>module comprising a set of functions for actions within an user agent</span>.
            It has been designed to be compatible with XQuery 3.0 and XSLT 3.0, as well as any
            other standard based on XPath 3.0.
         </p>
      </div>
      <div class="toc">
         
         <h2><a name="contents" id="contents"></a>Table of Contents
         </h2>
         <p class="toc">1 <a href="#d4e69">Introduction</a><br />
            1.1 <a href="#d4e77">Namespace conventions</a><br />
            1.2 <a href="#d4e96">Error management</a><br />
            2 <a href="#d4e107">Actions</a><br />
            2.1 <a href="#d4e112">The ua:action() function</a><br />
            3 <a href="#d4e183">Mutation observers</a><br />
            3.1 <a href="#d4e190">The ua:observer() function</a><br />
            3.2 <a href="#d4e246">The ua:connect-observer() function</a><br />
            3.3 <a href="#d4e295">The ua:disconnect-observer() function</a><br />
            4 <a href="#d4e322">Events</a><br />
            4.1 <a href="#d4e327">The ua:create-event() function</a><br />
            
         </p>
         
         <h3><a name="appendices" id="appendices"></a>Appendices
         </h3>
         <p class="toc">A <a href="#d4e369">References</a><br />
            B <a href="#d4e403">Summary of Error Conditions</a><br />
            
         </p>
      </div>
      <hr />
      <div class="body">
         <div class="div1">
            
            <h2><a name="d4e69" id="d4e69"></a>1 Introduction
            </h2>
            <p>This proposal defines a <span>module for providing functions dealing with actions within
                  an user agent</span>. It has been designed to be compatible with XQuery 3.0 and XSLT 3.0, as well as any
               other standard
               based on XPath 3.0.
            </p>
            <div class="div2">
               
               <h3><a name="d4e77" id="d4e77"></a>1.1 Namespace conventions
               </h3>
               <p>The module defined by this document defines functions and elements in the namespace
                  <code>http://expath.org/spec/user-agent/</code>. In this document, the
                  <code>ua</code> prefix, when used, is bound to this namespace URI.
               </p>
               <p>Error codes are defined in the namespace <code>http://expath.org/ns/error</code>. In
                  this document, the <code>err</code> prefix, when used, is bound to this namespace
                  URI.
               </p>
            </div>
            <div class="div2">
               
               <h3><a name="d4e96" id="d4e96"></a>1.2 Error management
               </h3>
               <p>Error conditions are identified by a code (a <code>QName</code>). When such an error
                  condition is reached during the execution of the function, a dynamic error is thrown,
                  with the corresponding error code (as if the standard XPath function
                  <code>error</code> had been called).
               </p>
            </div>
         </div>
         <div class="div1">
            
            <h2><a name="d4e107" id="d4e107"></a>2 Actions
            </h2>
            <p>These functions define actions to be executed by direct invoking or when a certain
               event occurs.
            </p>
            <div class="div2">
               
               <h3><a name="d4e112" id="d4e112"></a>2.1 The <code>ua:action()</code> function
               </h3>
               <p>This function defines an action to be invoked when a DOM event occurs.</p>
               <div class="exampleInner"><pre>
<code class="function">ua:action</code>($id as <code class="type">xs:ID</code>,
	$parameters as <code class="type">map(xs:string, xs:string)</code>,
	$code-block as <code class="type">item()*</code>) as <code class="type">empty()</code>
</pre></div>
               <div class="exampleInner"><pre>
<code class="function">ua:action</code>($id as <code class="type">xs:ID</code>,
	$event-name as <code class="type">xs:QName</code>,
	$parameters as <code class="type">map(xs:string, xs:string</code>,
	$code-block as <code class="type">item()*</code>) as <code class="type">empty()</code>
</pre></div>
               <ul>
                  <li>
                     <p><code>$id</code> is the action's identificator. If the identificator is not unique within the script,
                        this is an error <a href="#errUA01">[err:UA01]</a>.
                     </p>
                  </li>
                  <li>
                     <p><code>$event-name</code> represents the name of the event that triggers the execution of the action.
                        If the event does not exist, this is an error <a href="#errUA02">[err:UA02]</a>.
                     </p>
                  </li>
                  <li>
                     <p><code>$parameters</code> represents the parameters passed for the execution of the action.
                     </p>
                  </li>
                  <li>
                     <p><code>$code-block</code> represents the code to be executed.
                     </p>
                  </li>
               </ul>
            </div>
         </div>
         <div class="div1">
            
            <h2><a name="d4e183" id="d4e183"></a>3 Mutation observers
            </h2>
            <p>These functions deal with Mutation observers, as they are defined in <a href="#dom-4">[W3C DOM4]</a>.
            </p>
            <div class="div2">
               
               <h3><a name="d4e190" id="d4e190"></a>3.1 The <code>ua:observer()</code> function
               </h3>
               <p>This function creates a mutations observer. It has two signatures, one taking as second
                  parameter a list of action handlers separated by spaces,
                  and the other one considering as second parameter a function item.
               </p>
               <div class="exampleInner"><pre>
<code class="function">ua:observer</code>($id as <code class="type">xs:ID</code>, $action-handlers as <code class="type">xs:IDREFS</code>) as <code class="type">empty()</code>
</pre></div>
               <div class="exampleInner"><pre>
<code class="function">ua:observer</code>($id as <code class="type">xs:ID</code>, $action as <code class="type">function(*)</code>) as <code class="type">empty()</code>
</pre></div>
               <ul>
                  <li>
                     <p><code>$id</code> is the observer's identificator. If the identificator is not unique within the script,
                        this is an error <a href="#errUA01">[err:UA01]</a>.
                     </p>
                  </li>
                  <li>
                     <p><code>$action-handlers</code> is the list of action handlers separated by spaces, to be executed. If the action
                        handler are not unique within the script,
                        this is an error <a href="#errUA01">[err:UA01]</a>.
                     </p>
                  </li>
                  <li>
                     <p><code>$action</code> is the function item to be executed.
                     </p>
                  </li>
               </ul>
            </div>
            <div class="div2">
               
               <h3><a name="d4e246" id="d4e246"></a>3.2 The <code>ua:connect-observer()</code> function
               </h3>
               <p>This function connects an observer to a node, in order to observe the node mutations.</p>
               <div class="exampleInner"><pre>
<code class="function">ua:connect-observer</code>($observer-handler as <code class="type">xs:IDREF</code>, $node-selector as <code class="type">xs:string</code>,
	$options as <code class="type">map(xs:string, xs:string)</code>) as <code class="type">empty()</code>
</pre></div>
               <ul>
                  <li>
                     <p><code>$observer-handler</code> is the observer's handler. If the identificator does not exist, this is an error
                        <a href="#errUA03">[err:UA03]</a>.
                     </p>
                  </li>
                  <li>
                     <p><code>$node-selector</code> is the selector used to select the node to be observed. The selector can be an XPath
                        or a CSS selector. If the
                        selector selects multiple nodes, only the first one in document order will be observed.
                        If the selector selects no nodes, this is an error <a href="#errUA04">[err:UA04]</a>.
                     </p>
                     <div class="note">
                        <p class="prefix"><b>Note:</b></p>Details for differenciating between an XPath or CSS selector are to be given.
                     </div>
                  </li>
                  <li>
                     <p><code>$options</code> are the options describing the properties and values for observing the selected node.
                        See <a href="#dom-4">[W3C DOM4]</a> for more
                        details.
                     </p>
                  </li>
               </ul>
            </div>
            <div class="div2">
               
               <h3><a name="d4e295" id="d4e295"></a>3.3 The <code>ua:disconnect-observer()</code> function
               </h3>
               <p>This function disconnects an observer from a node.</p>
               <div class="exampleInner"><pre>
<code class="function">ua:disconnect-observer</code>($observer-handler as <code class="type">xs:IDREF</code>) as <code class="type">empty()</code>
</pre></div>
               <ul>
                  <li>
                     <p><code>$observer-handler</code> is the observer's handler. If the identificator does not exist, this is an error
                        <a href="#errUA03">[err:UA03]</a>.
                     </p>
                  </li>
               </ul>
            </div>
         </div>
         <div class="div1">
            
            <h2><a name="d4e322" id="d4e322"></a>4 Events
            </h2>
            <p>These functions deal with DOM events.</p>
            <div class="div2">
               
               <h3><a name="d4e327" id="d4e327"></a>4.1 The <code>ua:create-event()</code> function
               </h3>
               <p>This function creates a custom events.</p>
               <div class="exampleInner"><pre>
<code class="function">ua:create-event</code>($event-name as <code class="type">xs:QName</code>) as <code class="type">empty()</code>
</pre></div>
               <ul>
                  <li>
                     <p><code>$event-name</code> is the name of the custom event.
                     </p>
                  </li>
               </ul>
            </div>
         </div>
      </div>
      <div class="back">
         <div class="div1">
            
            <h2><a name="d4e369" id="d4e369"></a>A References
            </h2>
            <dl>
               <dt class="label"><a name="xpath-30" id="xpath-30"></a>XPath 3.0
               </dt>
               <dd>
                  	               <a href="http://w3.org/TR/xpath-30/">XML Path Language (XPath) 3.0</a>.
                  	               Jonathan Robie, Don Chamberlin, Michael Dyck, John Snelson, editors.
                  W3C Working Draft, 13 December 2011.
               </dd>
               <dt class="label"><a name="xslt-30" id="xslt-30"></a>XSLT 3.0
               </dt>
               <dd>                        
                  	               <a href="http://w3.org/TR/xslt-30/">XSL Transformations (XSLT) Version 3.0</a>.
                  	               Michael Kay, editor. W3C Working Draft, 10 July 2012.
               </dd>
               <dt class="label"><a name="xquery-30" id="xquery-30"></a>XQuery 3.0
               </dt>
               <dd>                        
                  	               <a href="http://w3.org/TR/xquery-30/">XQuery 3.0: An XML Query Language</a>.
                  	               Jonathan Robie, Don Chamberlin, Michael Dyck, John Snelson, editors.
                  W3C Working Draft, 13 December 2011.
               </dd>
               <dt class="label"><a name="xpath-functions-30" id="xpath-functions-30"></a>XPath and XQuery Functions and Operators 3.0
               </dt>
               <dd>
                  	               <a href="http://w3.org/TR/xpath-functions-30/">XPath and XQuery Functions and Operators 3.0</a>.
                  	               Michael Kay, editor. W3C Working Draft, 13 December 2011.
               </dd>
               <dt class="label"><a name="xpath-datamodel-30" id="xpath-datamodel-30"></a>XQuery and XPath Data Model 3.0
               </dt>
               <dd>
                  	               <a href="http://w3.org/TR/xpath-datamodel-30/">XQuery and XPath Data Model 3.0</a>.
                  	   Norman Walsh, Anders Berglund, John Snelson, editors. W3C Working Draft, 13 December
                  2011.
               </dd>
               <dt class="label"><a name="dom-4" id="dom-4"></a>W3C DOM4
               </dt>
               <dd>
                  	               <a href="http://w3.org/TR/dom/">W3C DOM4</a>.
                  	   Anne van Kesteren, Aryeh Gregor, Ms2ger, Alex Russell, Robin Berjon, editors.
                  W3C Last Call Working Draft, 04 February 2014.
               </dd>
            </dl>
         </div>
         <div class="div1">
            
            <h2><a name="d4e403" id="d4e403"></a>B Summary of Error Conditions
            </h2>
            <dl>
               <dt class="label"><a name="errUA01" id="errUA01"></a>err:UA01
               </dt>
               <dd>The identificator $id is not unique.</dd>
               <dt class="label"><a name="errUA02" id="errUA02"></a>err:UA02
               </dt>
               <dd>The event $event-name does not exist.</dd>
               <dt class="label"><a name="errUA03" id="errUA03"></a>err:UA03
               </dt>
               <dd>The referred identificator does not exist.</dd>
               <dt class="label"><a name="errUA04" id="errUA04"></a>err:UA04
               </dt>
               <dd>No node was selected.</dd>
            </dl>
         </div>
      </div><script type="text/javascript">
					var _gaq = _gaq || [];
					_gaq.push(['_setAccount', 'UA-43293529-1']);
					_gaq.push(['_trackPageview']);
					(function() {
					var ga = document.createElement('script'); ga.type =
					'text/javascript';
					ga.async = true;
					ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www')
					+
					'.google-analytics.com/ga.js';
					var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga,
					s);
					})();
				</script></body>
</html>